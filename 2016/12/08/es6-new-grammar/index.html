<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> ES6 function* yield yield* · 冷子欲-前端博客</title><meta name="description" content="ES6 function* yield yield* - lengziyu"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.lengziyu.com/atom.xml" title="冷子欲-前端博客"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">Archive</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">Tags</a></li><li class="nav-list-item"><a href="http://lengziyu.com" target="_blank" class="nav-list-link">个人网站</a></li><li class="nav-list-item"><a href="https://github.com/lengziyu" target="_blank" class="nav-list-link">GitHub</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">Rss</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">ES6 function* yield yield*</h1><div class="post-info">2016年12月8日<a href="/tags/es6/" title="es6" class="post-tag">#es6</a></div><div class="post-content"><p>这里主要讲解es6新语法<code>function*</code>、<code>yield</code>和<code>yield*</code>。<br><a id="more"></a></p>
<h1 id="function"><a href="#function" class="headerlink" title="function*"></a>function*</h1><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>定义一个generator（生成器）函数，返回一个Generator对象。</p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight sqf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">function* <span class="built_in">name</span>[ <span class="built_in">param</span>[ <span class="built_in">param</span>[ <span class="built_in">param</span>…]]] &#123; statements &#125;</div></pre></td></tr></table></figure>
<ul>
<li>name 函数名</li>
<li>param 传入函数的参数名，一个函数最多可有255个参数</li>
<li>statements 函数的主体</li>
</ul>
<h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p>生成器是一种可以在从中退出并在之后重新进入的函数。生成器环境在执行后会被保存，下次执行可继续使用。</p>
<p>调用生成器函数，并不立即执行主体，而是返回这个生成器函数的迭代器对象，当这个迭代器调用next()方法时，生成器函数主体会被执行至第一个 yield 表达式，该表达式定义了迭代器返回的值，或者，被 yield* 委托至另一个生成器函数。next() 方法返回一个对象，该对象有一个value属性，表示产出的值，和一个done属性，表示生成器是否已经产出了它最后的值。</p>
<h3 id="基本事例"><a href="#基本事例" class="headerlink" title="基本事例"></a>基本事例</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">function* idMaker()&#123;</div><div class="line">  <span class="keyword">var</span> index = 0;</div><div class="line">  <span class="keyword">while</span>(index&lt;3)</div><div class="line">    yield index++;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> <span class="keyword">gen</span> = idMaker();</div><div class="line"></div><div class="line">console.<span class="built_in">log</span>(<span class="keyword">gen</span>.next().value); <span class="comment">// 0</span></div><div class="line">console.<span class="built_in">log</span>(<span class="keyword">gen</span>.next().value); <span class="comment">// 1</span></div><div class="line">console.<span class="built_in">log</span>(<span class="keyword">gen</span>.next().value); <span class="comment">// 2</span></div><div class="line">console.<span class="built_in">log</span>(<span class="keyword">gen</span>.next().value); <span class="comment">// undefined</span></div></pre></td></tr></table></figure>
<h3 id="yield-事例"><a href="#yield-事例" class="headerlink" title="yield* 事例"></a>yield* 事例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">anotherGenerator</span>(<span class="params">i</span>) </span>&#123;</div><div class="line">  <span class="keyword">yield</span> i + <span class="number">1</span>;</div><div class="line">  <span class="keyword">yield</span> i + <span class="number">2</span>;</div><div class="line">  <span class="keyword">yield</span> i + <span class="number">3</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">generator</span>(<span class="params">i</span>)</span>&#123;</div><div class="line">  <span class="keyword">yield</span> i;</div><div class="line">  <span class="keyword">yield</span>* anotherGenerator(i);</div><div class="line">  <span class="keyword">yield</span> i + <span class="number">10</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> gen = generator(<span class="number">10</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(gen.next().value); <span class="comment">// 10</span></div><div class="line"><span class="built_in">console</span>.log(gen.next().value); <span class="comment">// 11</span></div><div class="line"><span class="built_in">console</span>.log(gen.next().value); <span class="comment">// 12</span></div><div class="line"><span class="built_in">console</span>.log(gen.next().value); <span class="comment">// 13</span></div><div class="line"><span class="built_in">console</span>.log(gen.next().value); <span class="comment">// 20</span></div></pre></td></tr></table></figure>
<h3 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h3><p>属于ES6规范，请使用babel转换</p>
<h1 id="yield"><a href="#yield" class="headerlink" title="yield"></a>yield</h1><h3 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h3><p>yield关键词用来停止或继续一个生成器函数。</p>
<h3 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yield<span class="string">[[ expression ]]</span></div></pre></td></tr></table></figure>
<ul>
<li>expression 用作返回值，如果忽略，则返回undefined</li>
</ul>
<h3 id="描述-1"><a href="#描述-1" class="headerlink" title="描述"></a>描述</h3><p>yield 关键字使生成器函数暂停执行，并返回跟在它后面的表达式的当前值. 可以把它想成是 return 关键字的一个基于生成器的版本.<br>yield 关键字实际返回一个对象，包含两个属性, value 和 done.  value 属性为 yield expression 的值,  done 是一个布尔值用来指示生成器函数是否已经全部完成.<br>一旦在 yield expression 处暂停,  除非外部调用生成器的 next() 方法，否则生成器的代码将不能继续执行. 这使得可以对生成器的执行以及渐进式的返回值进行直接控制.</p>
<h3 id="事例"><a href="#事例" class="headerlink" title="事例"></a>事例</h3><figure class="highlight qml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="built_in">var</span> index = <span class="number">0</span>;</div><div class="line">  <span class="keyword">while</span> (index &lt;= <span class="number">2</span>) <span class="comment">// when index reaches 3,</span></div><div class="line">                     <span class="comment">// yield's done will be true</span></div><div class="line">                     <span class="comment">// and its value will be undefined;</span></div><div class="line">    <span class="keyword">yield</span> index++;</div><div class="line">&#125;</div><div class="line">一旦生成器函数已定义，可以通过构造一个迭代器来使用它.</div><div class="line"><span class="built_in">var</span> iterator = foo();</div><div class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123; value:0, done:false &#125;</span></div><div class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123; value:1, done:false &#125;</span></div><div class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123; value:2, done:false &#125;</span></div><div class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123; value:undefined, done:true &#125;</span></div></pre></td></tr></table></figure>
<h1 id="yield-1"><a href="#yield-1" class="headerlink" title="yield*"></a>yield*</h1><h3 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h3><p>在生成器中，yield* 可以把需要 yield 的值委托给另外一个生成器或者其他任意的可迭代对象。</p>
<h3 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h3><p>yield*[[ expression ]]</p>
<ul>
<li>expression 任意可迭代的对象</li>
</ul>
<h3 id="描述-2"><a href="#描述-2" class="headerlink" title="描述"></a>描述</h3><p>yield<em> 一个可迭代对象，就相当于把这个可迭代对象的所有迭代值分次 yield 出去。<br>yield</em> 表达式本身的值就是当前可迭代对象迭代完毕（当done为true时）时的返回值。</p>
<h3 id="事例-1"><a href="#事例-1" class="headerlink" title="事例"></a>事例</h3><p><strong>委托给其他生成器</strong><br>以下代码中，g1() yield 出去的每个值都会在 g2() 的 next() 方法中返回，就像那些 yield 语句是写在 g2() 里一样。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">g1</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">yield</span> <span class="number">2</span>;</div><div class="line">  <span class="keyword">yield</span> <span class="number">3</span>;</div><div class="line">  <span class="keyword">yield</span> <span class="number">4</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">g2</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</div><div class="line">  <span class="keyword">yield</span>* g1();</div><div class="line">  <span class="keyword">yield</span> <span class="number">5</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> iterator = g2();</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123; value: 1, done: false &#125;</span></div><div class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123; value: 2, done: false &#125;</span></div><div class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123; value: 3, done: false &#125;</span></div><div class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123; value: 4, done: false &#125;</span></div><div class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123; value: 5, done: false &#125;</span></div><div class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123; value: undefined, done: true &#125;</span></div></pre></td></tr></table></figure></p>
<p><strong>委托给其他类型的可迭代对象</strong><br>除了生成器对象这一种可迭代对象，yield* 还可以 yield 其它任意的可迭代对象，比如说数组、字符串、arguments 对象等等。<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">function* g3() &#123;</div><div class="line">  <span class="keyword">yield</span>* [<span class="number">1</span>, <span class="number">2</span>];</div><div class="line">  <span class="keyword">yield</span>* <span class="string">"34"</span>;</div><div class="line">  <span class="keyword">yield</span>* arguments;</div><div class="line">&#125;</div><div class="line"></div><div class="line">var iterator = g3(<span class="number">5</span>, <span class="number">6</span>);</div><div class="line"></div><div class="line">console.log(iterator.<span class="keyword">next</span>()); <span class="regexp">//</span> &#123; <span class="symbol">value:</span> <span class="number">1</span>, <span class="symbol">done:</span> <span class="literal">false</span> &#125;</div><div class="line">console.log(iterator.<span class="keyword">next</span>()); <span class="regexp">//</span> &#123; <span class="symbol">value:</span> <span class="number">2</span>, <span class="symbol">done:</span> <span class="literal">false</span> &#125;</div><div class="line">console.log(iterator.<span class="keyword">next</span>()); <span class="regexp">//</span> &#123; <span class="symbol">value:</span> <span class="string">"3"</span>, <span class="symbol">done:</span> <span class="literal">false</span> &#125;</div><div class="line">console.log(iterator.<span class="keyword">next</span>()); <span class="regexp">//</span> &#123; <span class="symbol">value:</span> <span class="string">"4"</span>, <span class="symbol">done:</span> <span class="literal">false</span> &#125;</div><div class="line">console.log(iterator.<span class="keyword">next</span>()); <span class="regexp">//</span> &#123; <span class="symbol">value:</span> <span class="number">5</span>, <span class="symbol">done:</span> <span class="literal">false</span> &#125;</div><div class="line">console.log(iterator.<span class="keyword">next</span>()); <span class="regexp">//</span> &#123; <span class="symbol">value:</span> <span class="number">6</span>, <span class="symbol">done:</span> <span class="literal">false</span> &#125;</div><div class="line">console.log(iterator.<span class="keyword">next</span>()); <span class="regexp">//</span> &#123; <span class="symbol">value:</span> undefined, <span class="symbol">done:</span> <span class="literal">true</span> &#125;</div></pre></td></tr></table></figure></p>
<h3 id="yield-表达式的值"><a href="#yield-表达式的值" class="headerlink" title="yield* 表达式的值"></a>yield* 表达式的值</h3><p>yield* 是一个表达式，不是语句，所以它会有自己的值。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">g4</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">yield</span>* [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</div><div class="line">  <span class="keyword">return</span> <span class="string">"foo"</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> result;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">g5</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  result = <span class="keyword">yield</span>* g4();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> iterator = g5();</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123; value: 1, done: false &#125;</span></div><div class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123; value: 2, done: false &#125;</span></div><div class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123; value: 3, done: false &#125;</span></div><div class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &#123; value: undefined, done: true &#125;,</span></div><div class="line">                              <span class="comment">// 此时 g4() 返回了 &#123; value: "foo", done: true &#125;</span></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(result);          <span class="comment">// "foo"</span></div></pre></td></tr></table></figure></p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/12/08/redux-basics/" class="next">下一篇</a></div><div data-thread-key="2016/12/08/es6-new-grammar/" data-title="ES6 function* yield yield*" data-url="http://blog.lengziyu.com/2016/12/08/es6-new-grammar/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"seansun"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2015 - 2016 <a href="http://blog.lengziyu.com">lengziyu</a></p><powered>by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</powered></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>