<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Redux 简明教程（转） · 冷子欲-前端博客</title><meta name="description" content="Redux 简明教程（转） - lengziyu"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.lengziyu.com/atom.xml" title="冷子欲-前端博客"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">Archive</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">Tags</a></li><li class="nav-list-item"><a href="http://lengziyu.com" target="_blank" class="nav-list-link">个人网站</a></li><li class="nav-list-item"><a href="https://github.com/lengziyu" target="_blank" class="nav-list-link">GitHub</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">Rss</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Redux 简明教程（转）</h1><div class="post-info">2016年10月13日<a href="/tags/redux/" title="redux" class="post-tag">#redux</a></div><div class="post-content"><p>Redux 是 JavaScript 状态容器，提供可预测化的状态管理。</p>
<p>可以让你构建一致化的应用，运行于不同的环境（客户端、服务器、原生应用），并且易于测试。不仅于此，它还提供 超爽的开发体验，比如有一个<a href="https://github.com/gaearon/redux-devtools" target="_blank" rel="external">时间旅行调试器可以编辑后实时预览</a>。<br><a id="more"></a></p>
<p>Redux 除了和 React 一起用外，还支持其它界面库。<br>它体小精悍（只有2kB）且没有任何依赖。</p>
<h2 id="启示"><a href="#启示" class="headerlink" title="启示"></a>启示</h2><p>Redux 由 Flux 演变而来，但受 Elm 的启发，避开了 Flux 的复杂性。</p>
<h2 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h2><p>首先要区分 <code>store</code> 和 <code>state</code><br><code>state</code> 是应用的状态，一般本质上是一个普通对象<br>例如，我们有一个 Web APP，包含 计数器 和 待办事项 两大功能<br>那么我们可以为该应用设计出对应的存储数据结构（应用初始状态）：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** 应用初始 state，本代码块记为 code-1 **/</span></div><div class="line">&#123;</div><div class="line">  <span class="attribute">counter</span>: <span class="number">0</span>,</div><div class="line">  todos: []</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>store</code> 是应用状态 <code>state</code> 的管理者，包含下列四个函数：</p>
<ul>
<li>getState() # 获取整个 state</li>
<li>dispatch(action) # ※ 触发 state 改变的【唯一途径】※</li>
<li>subscribe(listener) # 您可以理解成是 DOM 中的 addEventListener</li>
<li>replaceReducer(nextReducer) # 一般在 Webpack Code-Splitting 按需加载的时候用</li>
</ul>
<p>二者的关系是：<code>state = store.getState()</code><br>Redux 规定，一个应用只应有一个单一的 <code>store</code>，其管理着唯一的应用状态 <code>state</code><br>Redux 还规定，不能直接修改应用的状态 <code>state</code>，也就是说，下面的行为是不允许的：</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var <span class="keyword">state</span> = store.getState()</div><div class="line"><span class="keyword">state</span>.counter = <span class="keyword">state</span>.counter + <span class="number">1</span> // 禁止在业务逻辑中直接修改 <span class="keyword">state</span></div></pre></td></tr></table></figure>
<p>若要改变 <code>state</code>，必须 <code>dispatch</code> 一个 <code>action</code>，这是修改应用状态的不二法门</p>
<div class="tip"><br>现在您只需要记住 action 只是一个包含 type 属性的普通对象即可<br>例如 { type: ‘INCREMENT’ }<br></div><br>上面提到，<code>state</code> 是通过 <code>store.getState()</code> 获取，那么 <code>store</code> 又是怎么来的呢？<br>想生成一个 <code>store</code>，我们需要调用 Redux 的 <code>createStore</code>：<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; createStore &#125; from <span class="string">'redux'</span></div><div class="line">...</div><div class="line"><span class="keyword">const</span> store = createStore(reducer, initialState) <span class="comment">// store 是靠传入 reducer 生成的哦！</span></div></pre></td></tr></table></figure><br><br><div class="tip"><br>现在您只需要记住 reducer 是一个 函数，负责更新并返回一个新的 state<br>而 initialState 主要用于前后端同构的数据同步（详情请关注 React 服务端渲染）<br></div>

<h2 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h2><p>上面提到，<code>action</code>（动作）实质上是包含 <code>type</code> 属性的普通对象，这个 <code>type</code> 是我们实现用户行为追踪的关键<br>例如，增加一个待办事项 的 <code>action</code> 可能是像下面一样：<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** 本代码块记为 code-2 **/</span></div><div class="line">&#123;</div><div class="line">  <span class="attribute">type</span>: <span class="string">'ADD_TODO'</span>,</div><div class="line">  <span class="attribute">payload</span>: &#123;</div><div class="line">    <span class="attribute">id</span>: <span class="number">1</span>,</div><div class="line">    <span class="attribute">content</span>: <span class="string">'待办事项1'</span>,</div><div class="line">    <span class="attribute">completed</span>: false</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当然，action 的形式是多种多样的，唯一的约束仅仅就是包含一个 type 属性罢了<br>也就是说，下面这些 action 都是合法的：<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** 如下都是合法的，但就是不够规范 **/</span></div><div class="line">&#123;</div><div class="line">  <span class="attribute">type</span>: <span class="string">'ADD_TODO'</span>,</div><div class="line">  <span class="attribute">id</span>: <span class="number">1</span>,</div><div class="line">  <span class="attribute">content</span>: <span class="string">'待办事项1'</span>,</div><div class="line">  <span class="attribute">completed</span>: false</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#123;</div><div class="line">  <span class="attribute">type</span>: <span class="string">'ADD_TODO'</span>,</div><div class="line">  <span class="attribute">abcdefg</span>: &#123;</div><div class="line">    <span class="attribute">id</span>: <span class="number">1</span>,</div><div class="line">    <span class="attribute">content</span>: <span class="string">'待办事项1'</span>,</div><div class="line">    <span class="attribute">completed</span>: false</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>虽说没有约束，但最好还是遵循<a href="https://github.com/acdlite/flux-standard-action" target="_blank" rel="external">规范</a></strong><br>如果需要新增一个代办事项，实际上就是将 code-2 中的 payload “写入” 到 state.todos 数组中（如何“写入”？在此留个悬念）：<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** 本代码块记为 code-3 **/</span></div><div class="line">&#123;</div><div class="line">  <span class="attribute">counter</span>: <span class="number">0</span>,</div><div class="line">  <span class="attribute">todos</span>: [&#123;</div><div class="line">    <span class="attribute">id</span>: <span class="number">1</span>,</div><div class="line">    <span class="attribute">content</span>: <span class="string">'待办事项1'</span>,</div><div class="line">    <span class="attribute">completed</span>: false</div><div class="line">  &#125;]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>刨根问底，action 是谁生成的呢？</p>
<h2 id="Action-Creator"><a href="#Action-Creator" class="headerlink" title="Action Creator"></a>Action Creator</h2><p><div class="tip"><br>Action Creator 可以是同步的，也可以是异步的<br></div><br>顾名思义，Action Creator 是 action 的创造者，本质上就是一个函数，返回值是一个 action（对象）<br>例如下面就是一个 “新增一个待办事项” 的 Action Creator：<br><figure class="highlight qml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** 本代码块记为 code-4 **/</span></div><div class="line"><span class="built_in">var</span> id = <span class="number">1</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">addTodo</span>(<span class="params">content</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attribute">type</span>: <span class="string">'ADD_TODO'</span>,</div><div class="line">    <span class="attribute">payload</span>: &#123;</div><div class="line">      <span class="attribute">id:</span><span class="string"> id</span>++,</div><div class="line">      <span class="attribute">content</span>: content, <span class="comment">// 待办事项内容</span></div><div class="line">      <span class="attribute">completed</span>: <span class="literal">false</span>  <span class="comment">// 是否完成的标识</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>将该函数应用到一个表单（假设 store 为全局变量，并引入了 jQuery ）：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">--!</span> 本代码块记为 <span class="attr">code-5</span> <span class="attr">--</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"todoInput"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"btn"</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">$(<span class="string">'#btn'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> content = $(<span class="string">'#todoInput'</span>).val() <span class="comment">// 获取输入框的值</span></div><div class="line">  <span class="keyword">var</span> action = addTodo(content) <span class="comment">// 执行 Action Creator 获得 action</span></div><div class="line">  store.dispatch(action) <span class="comment">// 改变 state 的不二法门：dispatch 一个 action！！！</span></div><div class="line">&#125;)</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>在输入框中输入 “待办事项2” 后，点击一下提交按钮，我们的 state 就变成了：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** 本代码块记为 code-6 **/</span></div><div class="line">&#123;</div><div class="line">  <span class="attribute">counter</span>: <span class="number">0</span>,</div><div class="line">  todos: [&#123;</div><div class="line">    id: <span class="number">1</span>,</div><div class="line">    content: <span class="string">'待办事项1'</span>,</div><div class="line">    completed: false</div><div class="line">  &#125;, &#123;</div><div class="line">    <span class="attribute">id</span>: <span class="number">2</span>,</div><div class="line">    content: <span class="string">'待办事项2'</span>,</div><div class="line">    completed: false</div><div class="line">  &#125;]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>通俗点讲，Action Creator 用于绑定到用户的操作（点击按钮等），其返回值 action 用于之后的 dispatch(action)</strong><br>刚刚提到过，action 明明就没有强制的规范，为什么 store.dispatch(action) 之后，<br>Redux 会明确知道是提取 action.payload，并且是对应写入到 state.todos 数组中？<br>又是谁负责“写入”的呢？悬念即将揭晓…</p>
<h2 id="Reducer"><a href="#Reducer" class="headerlink" title="Reducer"></a>Reducer</h2><p><strong>Reducer 必须是同步的纯函数</strong><br>用户每次 dispatch(action) 后，都会触发 reducer 的执行<br>reducer 的实质是一个函数，根据 action.type 来更新 state 并返回 nextState<br>最后会用 reducer 的返回值 nextState 完全替换掉原来的 state</p>
<p><div class="tip"><br>注意：上面的这个 “更新” 并不是指 reducer 可以直接对 state 进行修改<br>Redux 规定，须先复制一份 state，在副本 nextState 上进行修改操作<br>例如，可以使用 lodash 的 cloneDeep，也可以使用 Object.assign / map / filter/ … 等返回副本的函数<br></div><br>在上面 Action Creator 中提到的 待办事项的 reducer 大概是长这个样子 (为了容易理解，在此不使用 ES6 / Immutable.js)：<br><figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">/** 本代码块记为 code-<span class="number">7</span> **/</div><div class="line">var initState = &#123;</div><div class="line">  counter: <span class="number">0</span>,</div><div class="line">  todos: []</div><div class="line">&#125;</div><div class="line"></div><div class="line">function reducer(<span class="keyword">state</span>, action) &#123;</div><div class="line">  // ※ 应用的初始状态是在第一次执行 reducer 时设置的 ※</div><div class="line">  if (!<span class="keyword">state</span>) <span class="keyword">state</span> = initState</div><div class="line"></div><div class="line">  switch (action.type) &#123;</div><div class="line">    case 'ADD_TODO':</div><div class="line">      var nextState = _.cloneDeep(<span class="keyword">state</span>) // 用到了 lodash 的深克隆</div><div class="line">      nextState.todos.push(action.payload)</div><div class="line">      return nextState</div><div class="line"></div><div class="line">    <span class="keyword">default</span>:</div><div class="line">    // 由于 nextState 会把原 <span class="keyword">state</span> 整个替换掉</div><div class="line">    // 若无修改，必须返回原 <span class="keyword">state</span>（否则就是 undefined）</div><div class="line">      return <span class="keyword">state</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>通俗点讲，就是 reducer 返回啥，state 就被替换成啥</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>store 由 Redux 的 createStore(reducer) 生成</li>
<li>state 通过 store.getState() 获取，本质上一般是一个存储着整个应用状态的对象</li>
<li>action 本质上是一个包含 type 属性的普通对象，由 Action Creator (函数) 产生</li>
<li>改变 state 必须 dispatch 一个 action</li>
<li>reducer 本质上是根据 action.type 来更新 state 并返回 nextState 的函数</li>
<li>reducer 必须返回值，否则 nextState 即为 undefined</li>
<li>实际上，state 就是所有 reducer 返回值的汇总（本教程只有一个 reducer，主要是应用场景比较简单）</li>
</ul>
<p><strong>Action Creator =&gt; action =&gt; store.dispatch(action) =&gt; reducer(state, action) =&gt; 原 state state = nextState</strong></p>
<p>原文地址：<a href="https://github.com/kenberkeley/redux-simple-tutorial" target="_blank" rel="external">Redux 简明教程</a></p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/10/12/react-jsx-grammar/" class="next">下一篇</a></div><div data-thread-key="2016/10/13/Redux-学习笔记/" data-title="Redux 简明教程（转）" data-url="http://blog.lengziyu.com/2016/10/13/Redux-学习笔记/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"seansun"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2015 - 2016 <a href="http://blog.lengziyu.com">lengziyu</a></p><powered>by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</powered></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>